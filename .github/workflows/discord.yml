name: Discord notify

on:
  push:
    branches: [ "master", "main" ]
  pull_request:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord message
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          REPO: ${{ github.repository }}
          ACTOR: ${{ github.actor }}
          REF: ${{ github.ref_name }}
          URL: ${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }}
          MSG: ${{ github.event.head_commit.message }}
        run: |
          curl -H "Content-Type: application/json" \
               -d "{\"content\":\"ğŸ“Œ **$REPO** â€” push par **$ACTOR** sur **$REF**\nğŸ“ $MSG\nğŸ”— $URL\"}" \
               "$WEBHOOK"
